# 최적 세그먼트 크기 실험 - 빠른 시작 가이드

## 🎯 실험 구성

이 실험은 **두 개의 별도 스크립트**로 구성됩니다:

1. **`experiment_receiver.py`** - 수신자 (Receiver)
2. **`experiment_sender.py`** - 송신자 (Sender)

## 🚀 실행 방법

### 방법 1: 단일 머신에서 테스트 (로컬 테스트)

가장 간단한 방법입니다. 하나의 컴퓨터에서 두 개의 터미널을 사용합니다.

**터미널 1: 수신자 실행**
```bash
python3 experiment_receiver.py --host 127.0.0.1
```

**터미널 2: 송신자 실행**
```bash
python3 experiment_sender.py --host 127.0.0.1 --file-size 50
```

### 방법 2: 두 개의 별도 머신에서 테스트 (권장)

더 정확한 네트워크 성능 측정을 위해 두 대의 컴퓨터를 사용합니다.

#### 수신자 머신 (예: IP 192.168.1.100)

```bash
# 모든 네트워크 인터페이스에서 수신
python3 experiment_receiver.py --host 0.0.0.0
```

또는 특정 IP에서만 수신:
```bash
python3 experiment_receiver.py --host 192.168.1.100
```

#### 송신자 머신

```bash
# 수신자 IP로 데이터 전송
python3 experiment_sender.py --host 192.168.1.100 --file-size 100
```

## 📊 실행 예시

### 수신자 출력 예시

```
======================================================================
최적 세그먼트 크기 실험 - 수신자 (Receiver)
======================================================================
📋 바인딩 주소: 0.0.0.0
📋 TCP 포트: 9998
📋 MIDTP 포트: 9999
======================================================================

⏳ 송신자의 연결을 기다리고 있습니다...
💡 종료하려면 Ctrl+C를 누르세요.

🔵 TCP 수신자 시작: 0.0.0.0:9998
🔴 MIDTP 수신자 시작: 0.0.0.0:9999

[TCP #1] 연결 수신: ('192.168.1.101', 54321)
[TCP #1] 📦 예상 크기: 50.00 MB
[TCP #1] 📊 진행: 50.2% (45.67 MB/s)
[TCP #1] ✅ 수신 완료: 50.00 MB
[TCP #1] ⏱️  소요 시간: 1.12초
[TCP #1] 📈 처리율: 44.64 MB/s

[MIDTP #1] 📡 세션 시작: ('192.168.1.101', 54322)
[MIDTP #1] 📦 예상 패킷 수: 37450
[MIDTP #1] 📊 진행: 26.7% (10000/37450 패킷, 38.21 MB/s)
[MIDTP #1] 📊 진행: 53.4% (20000/37450 패킷, 41.35 MB/s)
[MIDTP #1] 📊 진행: 80.1% (30000/37450 패킷, 42.18 MB/s)
[MIDTP #1] 🏁 FIN 수신
[MIDTP #1] ✅ 수신 완료: 50.00 MB
[MIDTP #1] 📦 수신 패킷: 37450/37450
[MIDTP #1] ⏱️  소요 시간: 1.18초
[MIDTP #1] 📈 처리율: 42.37 MB/s
```

### 송신자 출력 예시

```
======================================================================
최적 세그먼트 크기 실험 - 송신자 (Sender)
======================================================================
📋 수신자 주소: 192.168.1.100:9998 (TCP), 192.168.1.100:9999 (MIDTP)
📋 파일 크기: 50 MB
📋 청크 크기 범위: [1400, 2800, 4200, 5600, 7000, 8400, 9800, 11200, 12600, 14000, 15400]
======================================================================

📦 50MB 크기의 더미 데이터 생성 중...
✅ 데이터 생성 완료.

🧪 청크 크기별 성능 측정 시작 (총 11회)

[1/11] 청크 크기: 1400 Bytes
--------------------------------------------------
  🔵 TCP 전송 중...
  ✅ TCP 처리율: 42.35 MB/s
  🔴 MIDTP 전송 중...
  ✅ MIDTP 처리율: 38.21 MB/s

[2/11] 청크 크기: 2800 Bytes
--------------------------------------------------
  🔵 TCP 전송 중...
  ✅ TCP 처리율: 45.67 MB/s
  🔴 MIDTP 전송 중...
  ✅ MIDTP 처리율: 52.34 MB/s

...

======================================================================
📊 실험 결과 요약
======================================================================
청크 크기 (Bytes)    TCP (MB/s)      MIDTP (MB/s)   
----------------------------------------------------------------------
1400                 42.35           38.21          
2800                 45.67           52.34          
4200                 46.12           68.45          
5600                 46.89           75.23          ← 최적!
7000                 47.23           72.11          
...
======================================================================

📊 MIDTP 최적 세그먼트 크기: 5600 Bytes
📊 최대 처리율: 75.23 MB/s
📊 TCP 평균 처리율: 46.50 MB/s

📈 결과 그래프 생성 중...
✅ 모든 실험 완료!
```

## 🎨 그래프 결과

실험이 완료되면 자동으로 그래프가 표시됩니다:

```
Throughput (MB/s)
      ^
   80 |                    *  ← MIDTP 최적점 (5600 Bytes, 75.23 MB/s)
      |                 *     *
   70 |              *           *
      |           *                 *
   60 |        *                       *
      |     *                             *
   50 |  *  o---o---o---o---o---o---o---o---o  ← TCP (안정적)
      | *
   40 |*
      |
      +------------------------------------------------> Chunk Size
       1400  2800  4200  5600  7000  8400  9800  ...
```

## 💡 실용적인 시나리오

### 시나리오 1: 빠른 사전 테스트 (5분)

```bash
# 터미널 1 (수신자)
python3 experiment_receiver.py

# 터미널 2 (송신자)
python3 experiment_sender.py --file-size 20
```

### 시나리오 2: 정밀 측정 (15분)

```bash
# 터미널 1 (수신자)
python3 experiment_receiver.py --host 0.0.0.0

# 터미널 2 (송신자)
python3 experiment_sender.py --host 192.168.1.100 --file-size 200 --output results.png
```

### 시나리오 3: 커스텀 청크 크기 범위

```bash
# 송신자에서 청크 크기 범위 지정 (1000~10000, 500씩 증가)
python3 experiment_sender.py --host 192.168.1.100 --file-size 100 --chunk-sizes "1000-10000-500"
```

## 🔧 고급 옵션

### 포트 변경

```bash
# 수신자
python3 experiment_receiver.py --tcp-port 8000 --midtp-port 8001

# 송신자
python3 experiment_sender.py --host 192.168.1.100 --tcp-port 8000 --midtp-port 8001
```

### 그래프 저장

```bash
python3 experiment_sender.py --host 192.168.1.100 --file-size 100 --output my_results.png
```

## ⚠️ 주의사항

### 1. 수신자를 먼저 실행하세요

항상 수신자를 먼저 실행한 후 송신자를 실행해야 합니다.

### 2. 방화벽 설정

포트 9998 (TCP)와 9999 (UDP)가 열려 있어야 합니다:

```bash
# macOS
sudo /usr/libexec/ApplicationFirewall/socketfilterfw --add python3

# Linux (ufw)
sudo ufw allow 9998/tcp
sudo ufw allow 9999/udp
```

### 3. 네트워크 확인

수신자와 송신자가 서로 통신할 수 있는지 확인:

```bash
# 송신자에서 수신자로 ping
ping 192.168.1.100

# 포트 확인
nc -zv 192.168.1.100 9998
```

### 4. 실행 권한

```bash
# 실행 권한 부여
chmod +x experiment_receiver.py
chmod +x experiment_sender.py
```

## 🐛 문제 해결

### "연결 거부" 오류

**원인:** 수신자가 실행되지 않았거나 방화벽이 차단

**해결:**
1. 수신자가 먼저 실행 중인지 확인
2. 방화벽 규칙 확인
3. 올바른 IP 주소 사용 확인

### 수신자가 응답하지 않음

**원인:** 잘못된 바인딩 주소

**해결:**
```bash
# 모든 인터페이스에서 수신하도록 변경
python3 experiment_receiver.py --host 0.0.0.0
```

### 그래프가 표시되지 않음

**원인:** matplotlib 디스플레이 문제

**해결:**
```bash
# 파일로 저장
python3 experiment_sender.py --output results.png

# 또는 matplotlib 백엔드 변경
export MPLBACKEND=TkAgg
python3 experiment_sender.py
```

### 포트가 이미 사용 중

**확인:**
```bash
# 포트 사용 확인
lsof -i :9998
lsof -i :9999

# 프로세스 종료
kill -9 <PID>
```

## 📈 결과 분석

실험 완료 후:

1. **최적 청크 크기 확인**: 그래프에서 노란색 마커로 표시
2. **sender.py 최적화**: 발견된 최적 크기를 기본값으로 사용
3. **논문 작성**: 실험 결과를 연구 자료로 활용

## 🎓 다음 단계

1. 다양한 파일 크기로 실험 반복
2. 서로 다른 네트워크 환경에서 테스트
3. 패킷 손실률을 변경하며 비교
4. 최적 청크 크기를 실제 sender.py/receiver.py에 적용

---

**Happy Experimenting! 🚀**
